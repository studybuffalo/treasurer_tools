{% extends 'main/base.html' %}

{% block styles %}
    <style>
        #transactions {
            display: block;
        }

            #transactions .transaction:nth-child(even) {
                background-color: rgba(40, 120, 200, 0.1);
            }

        .transaction {
            align-content: flex-start;
            display: flex;
            flex-direction: column;
            padding: 1rem 0.25rem;
        }

            .transaction > .details {
                display: flex;
                flex-direction: column;
                align-content: flex-start;
            }

            .transaction > .details > .date-submitted {
                font-style: italic;
                font-size: 1.6rem;
                order: 2;
            }

            .transaction > .details >.memo {
                font-weight: 700;
                order: 1;
            }

            .transaction > .details > .payee-payer {
                font-style: italic;
                font-size: 1.6rem;
                order: 3;
            }

            .transaction > .options {
                order: 4;
            }
        .items {
            display: block;
            padding-left: 1rem;
        }
            .items .item:nth-child(even) {
                background-color: rgba(40, 120, 200, 0.1);
            }
            
        .item {
            align-content: flex-start;
            display: flex;
            flex-direction: column;
            font-size: 1.8rem;
            padding: 0.5rem;
        }

            .item em {
                font-size: 1rem;
            }

            .item > .details {
                align-content: flex-start;
                display: flex;
                flex-direction: column;
            }

                .item > .details > span {
                    display: block;
                }

                .item > .details > .date-item {
                    font-size: 1.4rem;
                    font-style: italic;
                    order: 2;
                }

                .item > .details > .description {
                    font-weight: 700;
                    order: 1;
                }

                .item > .details > .amount {
                    order: 3;
                    padding-left: 0.5rem;
                }

                .item > .details > .gst {
                    order: 4;
                    padding-left: 0.5rem;
                }

                .item > .details > .total {
                    order: 5;
                    padding-left: 0.5rem;
                }

            .item > .financial-codes {
                align-content: flex-start;
                display: flex;
                flex-direction: column;
                font-size: 1.6rem;
                padding: 1rem 0 0 0.5rem;
            }

            .item > .financial-codes > .financial-code {
                font-size: 1.4rem;
                font-style: italic;
                padding-left: 0.5rem;
            }

        .transaction > .totals em {
            font-size: 1.5rem;
        }
    </style>
{% endblock %}

{% block content %}
    <h1>Branch Transactions</h1>

    {% include 'main/messages.html' %}

    <ul>
        <li>All</li>
        <li>Expenses</li>
        <li>Revenue</li>
    </ul>

    <div>
        <a href="{% url 'financial_transactions:add' 'expense' %}">New expense</a>
        <a href="{% url 'financial_transactions:add' 'revenue' %}">New revenue</a>
    </div>

    <div>
        <a href="">Submit to transactions to CSHP</a>
    </div>

    <h2>Transaction List</h2>

    <div id="transactions">
        {% for transaction in transactions %}
            <div class="transaction"
                 data-transaction-type="{{ transaction.transaction_type }}"
                 data-date-submitted="{{ transaction.date_submitted }}"
                 data-memo="{{ transaction.memo }}"
                 data-payee-payer="{{ transaction.payee_payer}}">

                <div class="details">
                    <span class="date-submitted">{{ transaction.date_submitted }}</span>
                    <span class="memo">{{ transaction.memo }}</span>
                    <span class="payee-payer">{{ transaction.payee_payer }}</span>
                </div>

                <div class="options">
                    <a href="{% url 'financial_transactions:edit' 'expense' transaction.id %}">Edit</a>
                    <a href="{% url 'financial_transactions:delete' 'expense' transaction.id %}">Delete</a>
                </div>

                <div class="items">
                    {% for item in transaction.item_set.all %}
                        <div class="item"
                             data-description="{{ item.description }}"
                             data-amount="{{ item.amount }}"
                             data-gst="{{ item.gst }}"
                             data-total="{{ item.total }}">

                            <div class="details">
                                <span class="date-item">{{ item.date_item }}</span>
                                <span class="description">{{ item.description }}</span>
                                <span class="amount"><em>Amount</em> ${{ item.amount }}</span>
                                <span class="gst"><em>GST</em> ${{ item.gst }}</span>
                                <span class="total"><em>Total</em> {{ item.total }}</span>
                            </div>

                            <div class="financial-codes">
                                <strong>Account Codes</strong>
                                {% for financial_code in item.financialcodematch_set.all %}
                                    {% with financial_code.financial_code as code %}
                                        <span class="financial-code" data-code="{{ code.code }}" data-code-description="{{ code.description }}">
                                            {{ code.financial_code_group.budget_year.financial_code_system.title }}:
                                            {{ code }}
                                        </span>
                                    {% endwith %}
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                {% if attachment in transaction.attachmentmatch_set.all is not None %}
                    <div class="attachments">
                        Attachments
                        {% for attachment in transaction.attachmentmatch_set.all %}
                            <div class="attachments"><a href="{{ attachment.attachment.location.url }}">{{ attachment.attachment.location }}</a></div>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="totals">
                    <span><em>Total</em> {{ transaction.total }}</span>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}